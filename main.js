(()=>{"use strict";var t="wff-cohort-6",e={baseUrl:"https://nomoreparties.co/v1",headers:{authorization:"bdac4a1f-1572-41dd-943c-00b535864545","Content-Type":"application/json"}};function n(n,o,c){var i="".concat(e.baseUrl,"/").concat(t,"/").concat(n);return fetch(i,{method:o,headers:e.headers,body:JSON.stringify(c)}).then(r)}function r(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()}function o(t,e){var r=e.classList.contains("card__like-button_is-active")?"DELETE":"PUT";return n("cards/likes/".concat(t),r)}function c(t,e,r,o,c,i){var a=t._id,u=t.name,l=t.link,s=t.owner,p=t.likes,d=e.querySelector(".places__item").cloneNode(!0),f=d.querySelector(".card__image"),_=d.querySelector(".card__title"),m=d.querySelector(".card__delete-button"),y=d.querySelector(".card__like-button"),v=d.querySelector(".card__like_counter");return f.src=l,f.alt="На этой карточке ".concat(u),_.textContent=u,v.textContent=p.length,p.some((function(t){return t._id===i}))&&y.classList.add("card__like-button_is-active"),s._id===i?m.style.display="flex":m.style.display="none",f.addEventListener("click",c),m.addEventListener("click",(function(){var t;(t=a,n("cards/".concat(t),"DELETE")).then((function(){r(d)})).catch((function(t){console.error("При удалении карточки возникла ошибка:",t)}))})),y.addEventListener("click",(function(){o(a,y).then((function(t){v.textContent=t.likes.length,y.classList.toggle("card__like-button_is-active")})).catch((function(t){console.error("Ошибка при выполнении запроса:",t)}))})),d}function i(t){t.remove()}function a(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&l(e)}}function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function l(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}var s=function(t,e,n){var r=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},p=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled","disabled")):(e.classList.add(n.inactiveButtonClass),e.setAttribute("disabled","disabled"))};function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f,_,m=document.querySelector(".places__list"),y=document.querySelector("#card-template").content,v=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_load-photo"),h=document.querySelector(".profile__image"),q=b.querySelector(".popup__form"),C=S.querySelector(".popup__form"),E=C.querySelector(".popup__input_type_url"),L=q.querySelector(".popup__input_type_name"),k=q.querySelector(".popup__input_type_description"),g=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=document.querySelector(".popup_type_image"),w=A.querySelector(".popup__image"),T=A.querySelector(".popup__caption"),j=document.querySelectorAll(".popup"),B=document.querySelector(".popup_type_new-card"),O=B.querySelector(".popup__form"),D=O.querySelector(".popup__input_type_card-name"),I=O.querySelector(".popup__input_type_url"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_off",inputErrorClass:"form__input_err",errorClass:"form__input-error_active"};function M(t){var e=t.name,n=t.link;T.textContent=e,w.src=n,w.alt="Полюбуемся ".concat(e),u(A)}Promise.all([n("users/me","GET"),n("cards","GET")]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,i,a=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],u=r[1];console.log("Информация о пользователе",a),g.textContent=a.name,x.textContent=a.about,f=a._id,h.style.backgroundImage="url(".concat(a.avatar,")"),u.forEach((function(t){var e=c(t,y,i,o,(function(){M(t)}),f);m.append(e)})),console.log("Карточки",u)})).catch((function(){console.error("Ошибка подключения к серверу, загружено в Off-line режиме")})),document.querySelector(".profile__add-button").addEventListener("click",(function(){var t,e,n,r;t=O,e=P,n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector),n.forEach((function(n){n.value="",s(t,n,e)})),r.classList.add(e.inactiveButtonClass),r.setAttribute("disabled","disabled"),u(B)})),h.addEventListener("click",(function(){u(S)})),v.addEventListener("click",(function(){L.value=g.textContent,k.value=x.textContent,u(b)})),q.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=L.value,r=k.value,n("users/me","PATCH",{name:e,about:r})).then((function(){g.textContent=L.value,x.textContent=k.value,l(b)})).catch((function(t){console.error("При изменении информации возникла ошибка:",t)})).finally((function(){t.submitter.textContent="Сохранить"}))})),j.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_is-opened")&&l(t),e.target.classList.contains("popup__close")&&l(t)}))})),C.addEventListener("submit",(function(t){t.preventDefault();var e,r=E.value;t.submitter.textContent="Сохранение...",(e=r,n("users/me/avatar","PATCH",{avatar:e})).then((function(){h.style.backgroundImage="url(".concat(r,")"),l(S)})).catch((function(t){console.error("При изменении информации возникла ошибка:",t)})).finally((function(){t.submitter.textContent="Сохранить"}))})),B.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=D.value,r=I.value,n("cards","POST",{name:e,link:r})).then((function(e){var n={_id:e._id,name:e.name,link:e.link,likes:e.likes,owner:e.owner},r=c(n,y,i,o,(function(){M(n)}),f);m.prepend(r),t.target.reset(),l(B)})).catch((function(t){console.error("Ошибка при выполнении запроса:",t)})).finally((function(){t.submitter.textContent="Сохранить"}))})),_=P,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);p(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,r){var o=t.querySelector("#".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),p(n,r,e)}))}))}(t,_)}))})();